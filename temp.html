<!doctype html>
<html lang="en">
<head>

</head>
<body >
<script >   




class QuestionFormatter {
  constructor( patterns = [] ){
    this.patterns = patterns
  }

  parse(msg){
    for(let i = 0; i < this.patterns.length; i++ ){
      let res = this.patterns[i].parse(msg);
      if (res) return res
    }
    return null
  }

  addPattern(patternObj){ 
    if (patternObj instanceof Pattern){
      this.patterns.push(patternObj)
    }
  }
}


class Pattern { 
  constructor(regExp, type){
    this.regExp = regExp
    this.type = type
  }

  parse(text){
    let res = null
    let matched = text.match(this.regExp)
    console.log(text)
    console.log(this.regExp)
    if(matched){
      // console.log( matched.slice(1))
      console.log(matched)
      // res = matched
      return {
        type: this.type,
        templateWords: matched.slice(1)
      }
    }
    return res
  }
}


class BotResponseFactory {
  constructor(questionFormatter, responseCreatorsByQuestionsTypes){
    this.questionFormatter = questionFormatter
    this.responseCreatorsByQuestionsTypes = responseCreatorsByQuestionsTypes
  }
  makeResponse(msg){
    let question = this.questionFormatter.parse(msg);
    console.log(question)
    if(!question) { 
      // сказать, что не знает ответа 
    }
    return this.responseCreatorsByQuestionsTypes[question.type].answerOn( ...question.templateWords);
  }
}


class WeatherResponseCreator{
  static answerOn(day, city){
    return `The weather is cold in ${city} ${day}`
  }
}


responseCreators = { 
   'weather' : WeatherResponseCreator,
  //  'money' : money
}


const money = /convert (\d+(?:\.\d{0,9})?) (dollar(?:s?)|euro(?:s?)|hryvnia(?:s?)) to (dollar(?:s?)|euro(?:s?)|hryvnia(?:s?))/i


const weather = new Pattern( /What is the weather (tomorrow|today|on Monday|on Thuesday|on Wednesday|on Thursday|on Friday|on Saturday|on Sunday) in (Dnipro|Lviv|Kyiv|Kharkiv|Odessa)/i , 'weather')

const advice = /(.+\?)\s#@\)₴\?\$0(?:.*)/i

const show_note = /(?:.*)show(?:\s*)note(?:\s*:*)(.+)/i

const show_lsit = /(?:.*)show(?:\s*)note(?:\s*)list(?:.*)/i

const save_title = /Save note title: (.+)(?:,*\s*)body:(?:\s*)(.+)/i

const a = new Pattern (advice , 'a');

const sn = new Pattern(show_note, 'sn')

const snl = new Pattern(show_lsit, 'sl')

const st = new Pattern( save_title, 'st')

const m = new Pattern(money, 'money')

const parser = new QuestionFormatter([weather , m , st , snl, sn , a])

const factory = new BotResponseFactory(parser, responseCreators)




// fromCurrency = 'USD';
//   toCurrency = 'UAH';
//   var query = fromCurrency + '_' + toCurrency;

//   var url = 'https://free.currencyconverterapi.com/api/v6/convert?q='
//             + query + '&compact=ultra'





var url =  'http://api.apixu.com/v1/forecast.json?key=08733305e91447bf84272328182807&q=Dnipro&days=9'

fetch(url).then(res => {
  console.log(res) 
  res.json().then(data => {
    console.log(data)
    let forecast = data.forecast.forecastday;
    
    console.log((data.forecast.forecastday))
  })
})


// console.log (factory.makeResponse(`@bot “Що мені робити з домашкою якщо я нічого не розумію? #@)₴?$0`))

// console.log (factory.makeResponse(`@bot Show note  : “Pattern ‘Proxy’”`))


// console.log (factory.makeResponse('show note list'))


// console.log (factory.makeResponse(`Save note title: “Pattern ‘Proxy’”   ,body:    “JavaScript has new feature Proxy since ES2015”`))


// console.log (factory.makeResponse('convert 20.5 dollars to euro'))


// console.log (factory.makeResponse('What is the weather on Monday in Lviv?'))

// console.log(weather.parse('What is the weather on Monday in Lviv?'))





</script>
</body>